### **Лайв-кодинг ТЗ: Wallet с идемпотентностью и лимитами**

**Цель:** реализовать небольшой модуль/сервис “кошелёк”

#### **Формат**

* Можно делать как **HTTP API** (предпочтительно) или как **модуль с функциями** \+ тесты.  
* Язык/стек — Javascript / NestJS остальное на твое усмотрение.  
* Можно пользоваться AI-инструментами, но нужно **пояснять решения** и понимать написанный код

## **Функциональные требования**

### **1\) Пополнение**

**POST /topup**

Вход:

*userId: string*

*amount: number (только \> 0\)*

*currency: string (например, “RUB”)*

*idempotencyKey: string*

Поведение:

* Увеличить баланс пользователя на amount.  
* **Идемпотентность:** повторный запрос с тем же idempotencyKey **не должен** повторно зачислять. Должен вернуть **тот же результат**, что и первый раз.

### **2\) Списание**

**POST /charge**

Вход:

*userId: string*

*amount: number (только \> 0\)*

*currency: string*

*idempotencyKey: string*

*reason: string*

Поведение:

* Списать amount с баланса.  
* Нельзя уходить в минус: если средств не хватает → ошибка INSUFFICIENT\_FUNDS.  
* **Дневной лимит списаний:** например **10 000** в валюте на пользователя в сутки. Если превышен → ошибка LIMIT\_EXCEEDED.  
* **Идемпотентность:** повтор с тем же idempotencyKey — не списывать повторно, вернуть тот же результат.

**3\) Баланс и операции**

**GET /balance?userId=…\&limit=N**

Возвращает:

* текущий баланс  
* последние N операций (по времени, новые сверху)

## **Что сдаёшь по итогам**

* Код \+ как запустить (README или команды).  
* Коротко (2–3 минуты) объяснить:  
  * как реализована идемпотентность  
  * как решена проблема гонок  
  * почему выбрана такая структура кода

